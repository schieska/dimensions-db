{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://extrabold.tools/schemas/item.schema.json",
    "title": "Dimensions DB - Item",
    "type": "object",
    "additionalProperties": false,
    "required": [
        "type",
        "name",
        "brand",
        "sources",
        "measurements"
    ],
    "properties": {
        "$schema": {
            "type": "string"
        },
        "id": {
            "type": "string",
            "description": "Generated by build step for /dist. Optional in /src.",
            "pattern": "^[a-z0-9][a-z0-9_\\-\\.]*[a-z0-9]$"
        },
        "type": {
            "type": "string",
            "enum": [
                "container",
                "drawer",
                "furniture",
                "component",
                "insert",
                "tray"
            ]
        },
        "origin": {
            "description": "Where the item comes from. retail is default if omitted.",
            "anyOf": [
                {
                    "type": "null"
                },
                {
                    "type": "string",
                    "enum": [
                        "retail",
                        "community",
                        "prototype"
                    ]
                }
            ]
        },
        "name": {
            "type": "string",
            "minLength": 1,
            "maxLength": 140
        },
        "description": {
            "anyOf": [
                {
                    "type": "null"
                },
                {
                    "type": "string",
                    "maxLength": 500
                }
            ]
        },
        "translations": {
            "anyOf": [
                {
                    "type": "null"
                },
                {
                    "$ref": "common.schema.json#/$defs/i18nMap"
                }
            ]
        },
        "brand": {
            "type": "string",
            "minLength": 1,
            "maxLength": 80
        },
        "inner_size": {
            "description": "Inner usable dimensions. Always requires usable XYZ (bounding box). Can be extended with polygons or lofts.",
            "$ref": "common.schema.json#/$defs/size"
        },
        "outer_size": {
            "description": "Outer bounding dimensions. Always requires usable XYZ.",
            "anyOf": [
                {
                    "type": "null"
                },
                {
                    "$ref": "common.schema.json#/$defs/size"
                }
            ]
        },
        "visibility": {
            "description": "Author intent for browsing. Build may add component if referenced by other items.",
            "anyOf": [
                {
                    "type": "null"
                },
                {
                    "type": "array",
                    "minItems": 1,
                    "uniqueItems": true,
                    "items": {
                        "type": "string",
                        "enum": [
                            "product",
                            "standalone",
                            "component"
                        ]
                    }
                }
            ]
        },
        "materials": {
            "type": "array",
            "items": {
                "type": "string",
                "enum": [
                    "unknown",
                    "plastic",
                    "pp",
                    "abs",
                    "petg",
                    "wood",
                    "plywood",
                    "mdf",
                    "steel",
                    "aluminum",
                    "fabric",
                    "cardboard"
                ]
            },
            "uniqueItems": true
        },
        "features": {
            "type": "array",
            "items": {
                "type": "string",
                "enum": [
                    "stackable",
                    "lid-included",
                    "lid-optional",
                    "handles-open",
                    "handles-closed",
                    "rounded-corners",
                    "waterproof",
                    "transparent"
                ]
            },
            "uniqueItems": true
        },
        "parts": {
            "description": "Parent -> children relation with quantity.",
            "anyOf": [
                {
                    "type": "null"
                },
                {
                    "type": "array",
                    "items": {
                        "$ref": "#/$defs/partRef"
                    },
                    "minItems": 1
                }
            ]
        },
        "added_by": {
            "anyOf": [
                {
                    "$ref": "common.schema.json#/$defs/contributorId"
                },
                {
                    "type": "null"
                }
            ]
        },
        "sources": {
            "type": "array",
            "minItems": 1,
            "items": {
                "$ref": "#/$defs/source"
            }
        },
        "measurements": {
            "type": "array",
            "minItems": 1,
            "items": {
                "$ref": "#/$defs/measurementEntry"
            }
        },
        "tolerance_mm": {
            "anyOf": [
                {
                    "type": "null"
                },
                {
                    "$ref": "common.schema.json#/$defs/mmTol3"
                }
            ]
        },
        "accuracy": {
            "anyOf": [
                {
                    "type": "null"
                },
                {
                    "type": "string",
                    "enum": [
                        "high",
                        "medium",
                        "low"
                    ]
                }
            ]
        },
        "status": {
            "anyOf": [
                {
                    "type": "null"
                },
                {
                    "type": "string",
                    "enum": [
                        "draft",
                        "community",
                        "verified"
                    ]
                }
            ]
        },
        "identifiers": {
            "anyOf": [
                {
                    "type": "null"
                },
                {
                    "$ref": "#/$defs/identifiers"
                }
            ]
        },
        "variant_of": {
            "anyOf": [
                {
                    "type": "string"
                },
                {
                    "type": "null"
                }
            ]
        },
        "variant": {
            "anyOf": [
                {
                    "type": "null"
                },
                {
                    "type": "object",
                    "additionalProperties": false,
                    "properties": {
                        "color": {
                            "type": "string",
                            "maxLength": 40
                        },
                        "region": {
                            "type": "string",
                            "maxLength": 20
                        },
                        "revision": {
                            "type": "string",
                            "maxLength": 40
                        }
                    }
                }
            ]
        },
        "images": {
            "description": "References only. No image files in repo.",
            "anyOf": [
                {
                    "type": "null"
                },
                {
                    "type": "array",
                    "items": {
                        "$ref": "#/$defs/imageRef"
                    }
                }
            ]
        },
        "deprecated": {
            "anyOf": [
                {
                    "type": "boolean"
                },
                {
                    "type": "null"
                }
            ]
        },
        "replaced_by": {
            "anyOf": [
                {
                    "type": "string"
                },
                {
                    "type": "null"
                }
            ]
        },
        "updated_at": {
            "anyOf": [
                {
                    "$ref": "common.schema.json#/$defs/isoDate"
                },
                {
                    "type": "null"
                }
            ]
        },
        "referenced_by_count": {
            "description": "Generated in /dist. Count of how many items reference this item via parts.",
            "anyOf": [
                {
                    "type": "integer",
                    "minimum": 0
                },
                {
                    "type": "null"
                }
            ]
        }
    },
    "allOf": [
        {
            "if": {
                "required": [
                    "origin"
                ],
                "properties": {
                    "origin": {
                        "const": "community"
                    }
                }
            },
            "then": {
                "required": [
                    "added_by"
                ],
                "properties": {
                    "added_by": {
                        "not": {
                            "type": "null"
                        }
                    },
                    "sources": {
                        "contains": {
                            "properties": {
                                "kind": {
                                    "const": "community"
                                }
                            }
                        }
                    }
                }
            }
        },
        {
            "if": {
                "properties": {
                    "type": {
                        "enum": [
                            "container",
                            "drawer",
                            "tray",
                            "insert"
                        ]
                    }
                }
            },
            "then": {
                "anyOf": [
                    {
                        "required": [
                            "inner_size"
                        ]
                    },
                    {
                        "required": [
                            "outer_size"
                        ]
                    }
                ]
            }
        }
    ],
    "$defs": {
        "source": {
            "type": "object",
            "additionalProperties": false,
            "required": [
                "kind"
            ],
            "properties": {
                "kind": {
                    "type": "string",
                    "enum": [
                        "manufacturer",
                        "product",
                        "manual",
                        "datasheet",
                        "community",
                        "physical",
                        "other"
                    ]
                },
                "url": {
                    "$ref": "common.schema.json#/$defs/url"
                },
                "description": {
                    "type": "string"
                },
                "regions": {
                    "description": "If omitted, universal. If present, restricts applicability.",
                    "type": "array",
                    "items": {
                        "$ref": "common.schema.json#/$defs/regionCode"
                    },
                    "minItems": 1,
                    "uniqueItems": true
                },
                "langs": {
                    "description": "If omitted, universal. If present, restricts applicability.",
                    "type": "array",
                    "items": {
                        "$ref": "common.schema.json#/$defs/langCode"
                    },
                    "minItems": 1,
                    "uniqueItems": true
                },
                "note": {
                    "type": "string",
                    "maxLength": 200
                }
            }
        },
        "imageRef": {
            "type": "object",
            "additionalProperties": false,
            "required": [
                "kind",
                "url"
            ],
            "properties": {
                "kind": {
                    "type": "string",
                    "enum": [
                        "product",
                        "manual",
                        "community",
                        "other"
                    ]
                },
                "url": {
                    "$ref": "common.schema.json#/$defs/url"
                },
                "regions": {
                    "type": "array",
                    "items": {
                        "$ref": "common.schema.json#/$defs/regionCode"
                    },
                    "minItems": 1,
                    "uniqueItems": true
                },
                "langs": {
                    "type": "array",
                    "items": {
                        "$ref": "common.schema.json#/$defs/langCode"
                    },
                    "minItems": 1,
                    "uniqueItems": true
                },
                "note": {
                    "type": "string",
                    "maxLength": 200
                }
            }
        },
        "measurementEntry": {
            "type": "object",
            "additionalProperties": false,
            "required": [
                "by",
                "method",
                "tool",
                "date"
            ],
            "properties": {
                "by": {
                    "$ref": "common.schema.json#/$defs/contributorId"
                },
                "type": {
                    "description": "Type of measurement entry.",
                    "type": "string",
                    "enum": [
                        "initial",
                        "correction",
                        "verification"
                    ],
                    "default": "initial"
                },
                "method": {
                    "type": "string",
                    "enum": [
                        "manual",
                        "manufacturer-spec",
                        "community-average",
                        "calculated"
                    ]
                },
                "tool": {
                    "type": "string",
                    "enum": [
                        "caliper",
                        "ruler",
                        "tape",
                        "unknown"
                    ]
                },
                "protocol": {
                    "anyOf": [
                        {
                            "type": "string",
                            "enum": [
                                "inner_at_bottom",
                                "inner_at_mid",
                                "inner_at_top",
                                "usable_inner_conservative",
                                "unknown"
                            ]
                        },
                        {
                            "type": "null"
                        }
                    ]
                },
                "date": {
                    "$ref": "common.schema.json#/$defs/isoDate"
                },
                "notes": {
                    "anyOf": [
                        {
                            "type": "string",
                            "maxLength": 240
                        },
                        {
                            "type": "null"
                        }
                    ]
                }
            }
        },
        "identifiers": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "ean": {
                    "type": "array",
                    "items": {
                        "type": "string",
                        "pattern": "^\\d{8}$|^\\d{12}$|^\\d{13}$|^\\d{14}$"
                    },
                    "uniqueItems": true
                },
                "upc": {
                    "type": "array",
                    "items": {
                        "type": "string",
                        "pattern": "^\\d{12}$"
                    },
                    "uniqueItems": true
                },
                "asin": {
                    "type": "array",
                    "items": {
                        "type": "string",
                        "pattern": "^[A-Z0-9]{10}$"
                    },
                    "uniqueItems": true
                },
                "mpn": {
                    "type": "array",
                    "items": {
                        "type": "string",
                        "minLength": 1,
                        "maxLength": 80
                    },
                    "uniqueItems": true
                },
                "sku": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "additionalProperties": false,
                        "required": [
                            "value"
                        ],
                        "properties": {
                            "value": {
                                "type": "string",
                                "minLength": 1,
                                "maxLength": 80
                            },
                            "system": {
                                "anyOf": [
                                    {
                                        "type": "string",
                                        "maxLength": 40
                                    },
                                    {
                                        "type": "null"
                                    }
                                ]
                            },
                            "region": {
                                "anyOf": [
                                    {
                                        "type": "string",
                                        "maxLength": 20
                                    },
                                    {
                                        "type": "null"
                                    }
                                ]
                            }
                        }
                    }
                }
            }
        },
        "partRef": {
            "type": "object",
            "additionalProperties": false,
            "required": [
                "ref",
                "qty"
            ],
            "properties": {
                "ref": {
                    "type": "string",
                    "minLength": 2,
                    "maxLength": 120
                },
                "qty": {
                    "type": "integer",
                    "minimum": 1,
                    "maximum": 100
                }
            }
        },
        "shapeBox": {
            "type": "object",
            "additionalProperties": false,
            "required": [
                "kind"
            ],
            "properties": {
                "kind": {
                    "const": "box"
                },
                "fillet_mm": {
                    "anyOf": [
                        {
                            "type": "number",
                            "minimum": 0
                        },
                        {
                            "type": "null"
                        }
                    ]
                }
            }
        },
        "shapeStepped": {
            "type": "object",
            "additionalProperties": false,
            "required": [
                "kind",
                "levels"
            ],
            "properties": {
                "kind": {
                    "const": "stepped"
                },
                "levels": {
                    "type": "array",
                    "minItems": 2,
                    "items": {
                        "type": "object",
                        "additionalProperties": false,
                        "required": [
                            "z",
                            "profile",
                            "x",
                            "y"
                        ],
                        "properties": {
                            "z": {
                                "type": "number",
                                "minimum": 0
                            },
                            "profile": {
                                "const": "rect"
                            },
                            "x": {
                                "type": "number",
                                "exclusiveMinimum": 0
                            },
                            "y": {
                                "type": "number",
                                "exclusiveMinimum": 0
                            }
                        }
                    }
                }
            }
        },
        "shapeLoft": {
            "type": "object",
            "additionalProperties": false,
            "required": [
                "kind",
                "levels"
            ],
            "properties": {
                "kind": {
                    "const": "loft"
                },
                "levels": {
                    "type": "array",
                    "minItems": 2,
                    "items": {
                        "type": "object",
                        "additionalProperties": false,
                        "required": [
                            "z",
                            "polygon"
                        ],
                        "properties": {
                            "z": {
                                "type": "number",
                                "minimum": 0
                            },
                            "polygon": {
                                "type": "array",
                                "minItems": 3,
                                "items": {
                                    "type": "array",
                                    "minItems": 2,
                                    "maxItems": 2,
                                    "prefixItems": [
                                        {
                                            "type": "number"
                                        },
                                        {
                                            "type": "number"
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}